openapi: 3.0.3
info: { title: Cable Platform API, version: 1.0.0 }
servers: [{ url: http://localhost:8080 }]
paths:
  /health:
    get:
      summary: API health
      responses: { '200': { description: OK } }
  /v1/me:
    get:
      summary: Current user
      security: [{ bearerAuth: [] }]
      responses: { '200': { description: OK } }
  /v1/drc/run:
    post:
      summary: Run DRC
      requestBody:
        required: true
        content:
          application/json:
            schema:
              title: CableDesign
              type: object
              required: [id, name, cores]
              properties:
                id:
                  type: string
                name:
                  type: string
                cores:
                  type: integer
                  minimum: 1
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                title: DRCResult
                type: object
                required: [design_id, findings, severity_summary]
                properties:
                  design_id:
                    type: string
                  findings:
                    type: array
                    items:
                      type: object
                      required: [code, message, severity]
                      properties:
                        code:
                          type: string
                        message:
                          type: string
                        severity:
                          type: string
                          enum: [info, warn, error]
                        path:
                          type: string
                  severity_summary:
                    type: object
                    properties:
                      info:
                        type: integer
                      warn:
                        type: integer
                      error:
                        type: integer
  /v1/projects:
    get:
      summary: List projects
      description: Get paginated list of projects
      responses:
        '200':
          description: Projects retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProjectList'
  /v1/projects/{id}:
    get:
      summary: Get project
      description: Get a specific project by ID
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: Project ID
      responses:
        '200':
          description: Project retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Project'
        '404':
          description: Project not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /admin/users:
    get:
      summary: List admin users
      description: Get paginated list of admin users with optional search
      security: [{ bearerAuth: [] }]
      parameters:
        - name: query
          in: query
          schema:
            type: string
          description: Search query for name or email (case-insensitive substring)
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 25
          description: Maximum number of users to return
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
          description: Number of users to skip
      responses:
        '200':
          description: List of admin users
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminUserList'
        '400':
          description: Bad request - invalid parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /admin/users/{id}/deactivate:
    post:
      summary: Deactivate admin user
      description: Deactivate an admin user account
      security: [{ bearerAuth: [] }]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: User ID to deactivate
      responses:
        '200':
          description: User deactivated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminUser'
        '403':
          description: Forbidden - admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /admin/users/{id}/reactivate:
    post:
      summary: Reactivate admin user
      description: Reactivate a deactivated admin user account
      security: [{ bearerAuth: [] }]
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          description: User ID to reactivate
      responses:
        '200':
          description: User reactivated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminUser'
        '403':
          description: Forbidden - admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /admin/db/stats:
    get:
      summary: Database statistics
      description: Get database connection health and entity counts
      security: [{ bearerAuth: [] }]
      responses:
        '200':
          description: Database statistics retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AdminDbStats'
        '403':
          description: Forbidden - admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /admin/flags:
    get:
      summary: List feature flags
      description: Get feature flags filtered by scope and optional workspaceId
      security: [{ bearerAuth: [] }]
      parameters:
        - name: scope
          in: query
          required: false
          schema:
            type: string
            enum: [org, workspace]
            default: org
          description: Scope of feature flags to retrieve
        - name: workspaceId
          in: query
          required: false
          schema:
            type: string
          description: Workspace ID (required when scope is workspace)
      responses:
        '200':
          description: Feature flags retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FeatureFlags'
        '403':
          description: Forbidden - admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /admin/flags/toggle:
    post:
      summary: Toggle feature flag
      description: Enable or disable a feature flag
      security: [{ bearerAuth: [] }]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FeatureFlagToggleRequest'
      responses:
        '200':
          description: Feature flag toggled successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FeatureFlagToggleResponse'
        '400':
          description: Bad request - flag not found or invalid parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden - admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    AdminUser:
      $ref: '../../schemas/v1/admin-user.schema.json'
    AdminUserList:
      $ref: '../../schemas/v1/admin-user-list.schema.json'
    AdminDbStats:
      $ref: '../../schemas/v1/admin-db-stats.schema.json'
    FeatureFlag:
      $ref: '../../schemas/v1/feature-flag.schema.json'
    FeatureFlags:
      $ref: '../../schemas/v1/feature-flags.schema.json'
    FeatureFlagToggleRequest:
      $ref: '../../schemas/v1/feature-flag-toggle-request.schema.json'
    FeatureFlagToggleResponse:
      $ref: '../../schemas/v1/feature-flag-toggle-response.schema.json'
    Project:
      $ref: '../../schemas/v1/project.schema.json'
    ProjectList:
      $ref: '../../schemas/v1/project-list.schema.json'
    Error:
      type: object
      required: [error]
      properties:
        error:
          type: string
        message:
          type: string
        details:
          type: object
